<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Algebra Shooter Game - InfinityLabs</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #c0d0ff, #f0f0f0);
    }
    h1 {
      text-align: center;
      margin-top: 10px;
    }
    .game-info {
      text-align: center;
      margin-bottom: 5px;
    }
    .game-box {
      background-color: white;
      position: relative;
      margin: auto;
      width: 80vw;
      height: 70vh;
      border: 3px solid #888;
      border-radius: 10px;
      overflow: hidden;
    }
    .shooter {
      width: 60px;
      height: 60px;
      background-color: crimson;
      border-radius: 50%;
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      transition: left 0.05s linear;
    }
    .bullet {
      width: 5px;
      height: 20px;
      background-color: limegreen;
      position: absolute;
      display: none;
    }
    .choice {
      position: absolute;
      padding: 10px 20px;
      background-color: #ff9999;
      border-radius: 8px;
      color: white;
      font-size: 1.1rem;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
      cursor: default;
    }
    #gameOver {
      text-align: center;
      font-size: 1.5rem;
      color: red;
      margin-top: 10px;
      height: 30px;
      transition: opacity 0.3s ease;
    }
  </style>
</head>
<body>
  <h1>ðŸŽ¯ Algebra Shooter</h1>
  <div class="game-info">
    Score: <span id="score">0</span> |
    Lives: <span id="lives">3</span> |
    Time: <span id="time">--</span>
  </div>
  <div class="game-box" id="gameBox">
    <div class="shooter" id="shooter"></div>
    <div class="bullet" id="bullet"></div>
  </div>
  <div id="gameOver"></div>

  <script>
    const shooter = document.getElementById('shooter');
    const bullet = document.getElementById('bullet');
    const gameBox = document.getElementById('gameBox');
    const gameOverDisplay = document.getElementById('gameOver');
    const scoreDisplay = document.getElementById('score');
    const livesDisplay = document.getElementById('lives');

    let keys = {};
    let bulletInterval;
    let answerElements = [];
    let correctAnswer;
    let score = 0;
    let lives = 3;
    let gameActive = true;

    const getRandom = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    function generateQuestion() {
      let a = getRandom(1, 10);
      let b = getRandom(1, 10);
      correctAnswer = a;
      return {
        question: `x + ${b} = ${a + b}`,
        correct: a
      };
    }

    function renderQuestion() {
      if (!gameActive) return;
      answerElements.forEach(el => el.remove());
      const { question, correct } = generateQuestion();
      correctAnswer = correct;

      for (let i = 0; i < 4; i++) {
        const val = i === 0 ? correct : correct + getRandom(-5, 5);
        const choice = document.createElement('div');
        choice.className = 'choice';
        choice.textContent = val;
        choice.dataset.answer = val;
        choice.style.top = `${getRandom(50, gameBox.clientHeight - 150)}px`;
        choice.style.left = `${getRandom(50, gameBox.clientWidth - 100)}px`;
        gameBox.appendChild(choice);
        answerElements.push(choice);
      }
    }

    function shootBullet() {
      if (!gameActive) return;
      bullet.style.display = 'block';
      bullet.style.left = `${shooter.offsetLeft + shooter.offsetWidth/2 - 2.5}px`;
      bullet.style.top = `${shooter.offsetTop}px`;

      clearInterval(bulletInterval);
      bulletInterval = setInterval(() => {
        bullet.style.top = `${bullet.offsetTop - 10}px`;
        if (bullet.offsetTop <= 0) {
          bullet.style.display = 'none';
          clearInterval(bulletInterval);
        }

        answerElements.forEach(target => {
          const b = bullet.getBoundingClientRect();
          const t = target.getBoundingClientRect();
          const g = gameBox.getBoundingClientRect();

          if (b.bottom >= t.top && b.top <= t.bottom &&
              b.right >= t.left && b.left <= t.right) {
            clearInterval(bulletInterval);
            bullet.style.display = 'none';
            const isCorrect = parseInt(target.dataset.answer) === correctAnswer;
            if (isCorrect) {
              score++;
              gameOverDisplay.style.color = 'green';
              gameOverDisplay.textContent = "âœ” Correct!";
            } else {
              lives--;
              gameOverDisplay.style.color = 'red';
              gameOverDisplay.textContent = "âœ˜ Wrong!";
              if (lives <= 0) return endGame();
            }

            scoreDisplay.textContent = score;
            livesDisplay.textContent = lives;
            setTimeout(() => {
              gameOverDisplay.textContent = "";
              renderQuestion();
            }, 800);
          }
        });
      }, 30);
    }

    function endGame() {
      gameActive = false;
      gameOverDisplay.style.color = 'black';
      gameOverDisplay.textContent = `ðŸ’€ Game Over! Final Score: ${score}`;
    }

    function moveShooter() {
      if (!gameActive) return;
      const speed = 6;
      const left = shooter.offsetLeft;
      if (keys["ArrowLeft"] && left > 0) {
        shooter.style.left = `${left - speed}px`;
      }
      if (keys["ArrowRight"] && left + shooter.clientWidth < gameBox.clientWidth) {
        shooter.style.left = `${left + speed}px`;
      }
    }

    function gameLoop() {
      moveShooter();
      requestAnimationFrame(gameLoop);
    }

    document.addEventListener("keydown", e => {
      keys[e.key] = true;
      if ((e.key === " " || e.key === "Enter") && gameActive) shootBullet();
    });

    document.addEventListener("keyup", e => keys[e.key] = false);

    function initGame() {
      shooter.style.left = `${gameBox.clientWidth / 2 - shooter.clientWidth / 2}px`;
      renderQuestion();
      gameLoop();
    }

    window.onload = initGame;
  </script>
</body>
</html>
