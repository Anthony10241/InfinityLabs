<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Algebra Shooter Game - InfinityLabs</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Lora:wght@700&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: #f0f0f0;
      color: #800000;
    }

    h1 {
      font-family: 'Lora', serif;
      font-size: 2rem;
      margin: 10px;
      text-align: center;
    }

    .game-box {
      position: relative;
      width: 100vw;
      height: 100vh;
      background-color: white;
      overflow: hidden;
    }

    .shooter {
      width: 50px;
      height: 50px;
      background-color: #FF6B6B;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    .bullet {
      width: 5px;
      height: 10px;
      background-color: #00FF00;
      position: absolute;
      display: none;
    }

    .target {
      padding: 10px 15px;
      background-color: #FFD700;
      color: black;
      border-radius: 5px;
      position: absolute;
      font-size: 1.2rem;
    }

    .scoreboard {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 1.2rem;
    }

    .answer-label {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.2rem;
    }

    .game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: red;
    }
  </style>
</head>
<body>
  <div class="game-box" id="gameBox">
    <div class="scoreboard">Score: <span id="score">0</span> | Lives: <span id="lives">3</span></div>
    <div class="answer-label">Answer: <span id="answerDisplay">?</span></div>
    <div class="shooter" id="shooter"></div>
    <div class="bullet" id="bullet"></div>
    <div class="game-over" id="gameOver"></div>
  </div>

  <script>
    const gameBox = document.getElementById('gameBox');
    const shooter = document.getElementById('shooter');
    const bullet = document.getElementById('bullet');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const answerDisplay = document.getElementById('answerDisplay');
    const gameOverText = document.getElementById('gameOver');

    let score = 0;
    let lives = 3;
    let correctAnswer = 0;
    let bulletInterval;
    let targets = [];

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateProblem() {
      const a = getRandomInt(1, 20);
      const b = getRandomInt(1, 10);
      const operators = ['+', '-', '*', '/'];
      const op = operators[getRandomInt(0, operators.length - 1)];

      let question, x;
      switch (op) {
        case '+':
          question = `x + ${b} = ${a + b}`;
          x = a;
          break;
        case '-':
          question = `x - ${b} = ${a - b}`;
          x = a;
          break;
        case '*':
          question = `x * ${b} = ${a * b}`;
          x = a;
          break;
        case '/':
          question = `x / ${b} = ${a / b}`;
          x = a;
          break;
      }
      return { question, x };
    }

    function renderTargets() {
      targets.forEach(t => t.remove());
      targets = [];

      const correct = generateProblem();
      correctAnswer = correct.x;
      answerDisplay.textContent = correctAnswer;

      const allQuestions = [correct.question];
      while (allQuestions.length < 4) {
        const q = generateProblem().question;
        if (!allQuestions.includes(q)) allQuestions.push(q);
      }

      allQuestions.sort(() => Math.random() - 0.5);

      allQuestions.forEach((q, i) => {
        const target = document.createElement('div');
        target.className = 'target';
        target.textContent = q;
        target.style.left = `${150 + i * 200}px`;
        target.style.top = '150px';
        target.dataset.question = q;
        gameBox.appendChild(target);
        targets.push(target);
      });
    }

    function moveShooter(e) {
      const step = 20;
      const boxWidth = gameBox.offsetWidth;
      const shooterLeft = shooter.offsetLeft;
      if (e.key === 'ArrowLeft' && shooterLeft > 0) {
        shooter.style.left = `${Math.max(0, shooterLeft - step)}px`;
      } else if (e.key === 'ArrowRight' && shooterLeft < boxWidth - shooter.offsetWidth) {
        shooter.style.left = `${Math.min(boxWidth - shooter.offsetWidth, shooterLeft + step)}px`;
      }
    }

    function shootBullet() {
      bullet.style.display = 'block';
      bullet.style.left = `${shooter.offsetLeft + shooter.offsetWidth / 2 - 2}px`;
      bullet.style.top = `${shooter.offsetTop - 10}px`;

      bulletInterval = setInterval(() => {
        const bulletTop = bullet.offsetTop;
        bullet.style.top = `${bulletTop - 10}px`;

        if (bulletTop <= 0) {
          bullet.style.display = 'none';
          clearInterval(bulletInterval);
        }

        const bulletRect = bullet.getBoundingClientRect();
        targets.forEach(target => {
          const rect = target.getBoundingClientRect();
          if (
            bulletRect.top <= rect.bottom &&
            bulletRect.left >= rect.left &&
            bulletRect.right <= rect.right
          ) {
            clearInterval(bulletInterval);
            bullet.style.display = 'none';

            const text = target.textContent;
            const x = eval(text.replace('x', 'xVar').split('=')[0]);
            const rightSide = parseFloat(text.split('=')[1]);
            let xVar;

            try {
              // Try solving for x
              for (let i = -100; i <= 100; i++) {
                xVar = i;
                if (Math.abs(eval(text.replace('x', xVar)) - rightSide) < 0.001) {
                  if (xVar === correctAnswer) {
                    score++;
                    scoreEl.textContent = score;
                  } else {
                    lives--;
                    livesEl.textContent = lives;
                    if (lives <= 0) {
                      endGame();
                    }
                  }
                  renderTargets();
                  return;
                }
              }
            } catch {}
          }
        });
      }, 30);
    }

    function endGame() {
      gameOverText.textContent = `ðŸ’€ Game Over! Final Score: ${score}`;
      document.removeEventListener('keydown', keyHandler);
    }

    function keyHandler(e) {
      if (e.key === ' ' || e.key === 'Enter') {
        shootBullet();
      } else {
        moveShooter(e);
      }
    }

    function startGame() {
      score = 0;
      lives = 3;
      scoreEl.textContent = score;
      livesEl.textContent = lives;
      gameOverText.textContent = '';
      shooter.style.left = '50%';
      document.addEventListener('keydown', keyHandler);
      renderTargets();
    }

    startGame();
  </script>
</body>
</html>
